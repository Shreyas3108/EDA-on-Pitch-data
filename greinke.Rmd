---
title: "Exploratory Data Analysis using R on MLB Pitch data."
author: "Shreyas Raghavan"
date: "9 March 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Exploratory Data Analysis 

We would be using pitchFX dataset captured for the pitcher named Zack Greinke. Zack Grienke is a player for Kansas City. We would be analysing every pitching throughout the 2015 MLB season. The dataset has been captured using pitchfx , and consists of data points such as velocity , location of the ball in terms of x-axis and y-axis as well as outcome of each ball. In this report we would evaluate how to tackle Zack and score runs on the board. Grienke form in July 2015 was exceptional as reported by media outlets, but many batters denied and said it's been the same. So was there any media hype ? 

```{r echo = FALSE , message=FALSE}
library("tidyverse")
library(tidyr)
```

## Dataset 

PitchFX is a tracking system that collects data about each pitch in baseball that has been available since 2006.  The R package pitchFX by Carson Sievert allows one to scrape PitchFX data for particular days of interest. The dataset has been generated by scrapping and is widely available in csv format online. Data allows one to compare pitchers with respect to pitch speed, pitch type, breaks, location, and outcome. 

```{r echo = FALSE}
data = read.csv("greinke2015.csv")
```

The columns of the data are as follows: 

```{r echo =FALSE}
colnames(data)
```

The columns of the dataset with types are shown below: 

```{r echo =FALSE}
str(data)
```

The dataset is displayed below: 

```{r echo = FALSE}
head(data)
```

## Preprocessing the data 

The dataset has various inconsistency which we need to check. We also need to set dates and create new variables so that we can analyse Zack's performance in July and how his performance has been in the other months. This would help us give an insight about his performance. 

**First and formost , we need to check whether we have all the data or the data is missing (important points) ?**
We start off with his start speed , an important datapoint for a conclusion.

```{r , echo=FALSE}
summary(data$start_speed)
```

So as we can see there are three missing values , We would be ignoring the NA's and removing them from our dataset, since the NA values are of no use. 

```{r echo = FALSE}
data = subset(data , !is.na(data$start_speed))
```

**Now , as we saw previously from the dataset tab that dates are in factor format , and we have to further analyse Zack's performance for a particular month where he just killed it with his pitching which is July.** 

So , How do we set the dates and how to make more columns for months , year etc ? 
We use tidyr a simple yet sophisticated library which would help us in our  further cleaning and preprocessing of data. 

```{r echo = FALSE}
data$game_date = as.Date(data$game_date , format = "%m/%d/%Y")
data = separate(data, col = game_date,into = c("year", "month", "day"),sep = "-", remove = FALSE )
data$month = as.numeric(data$month)
data$july <- ifelse(data$month == 7, "july", "other")
summary(data$month)
``` 

As we can see that the minimum month is 4.0 referring to April , While the median count for month is our target month July. While the season went till October. It would be very interesting to see if the data can give us an insight why Zack was absolute beast in July as reported by the media . 

Let's see the count of pitch Zack did althroughout the season. 

```{r echo = FALSE}
summary(factor(data$month))
``` 

## UNIVARIATE ANALYSIS

The analysis would help us come to a conclusion so as to how consistent the data is , also basic statistics such as counts. 

We start by checking the overall speed ranges at which Zack has bowled throught the season. 

```{r echo = FALSE}
ggplot(data , aes(start_speed))+geom_histogram(bins = 8)+ggtitle("Speed ranges and the amount of pitch")
                                                                 
```
                                              
We must also compare so as to was he successful in July ? Was there something different about Zack ? 

The plot below shows how Zack did in july as compared to other months in terms of Speed of pitch.

```{r echo = FALSE}
#install.packages("gridExtra")
library(gridExtra)
par(mfrow = c(2,2))
p1 = ggplot(data = (subset(data , july == "july")) , aes(start_speed))+geom_histogram(bins = 8) + ggtitle("Distribution of Delivery in July in terms of Start Speed")
p2 = ggplot(data = (subset(data , july == "other")) , aes(start_speed))+geom_histogram(bins = 8) + ggtitle("Distribution of Delivery in other months in terms of Start Speed")
grid.arrange(p1, p2, ncol=2)
```

As we can see from the graph above there isn't too much variation in terms of the Start Speed , Maybe that Zack didn't change his way or strategy in the way he pitches the ball. 

We may want to see how it goes when Zack pitches the four-seam fastballs (denoted as "FF" under the pitch_type variable). We shall see a comparision between his july pitching and other months pitches in order to evaluate if there are any changes in that. 

```{r echo = FALSE}
ggplot(data = subset(data ,pitch_type == "FF"),aes(start_speed))+geom_histogram(bins = 45)+ggtitle("Fast seam delivery speed")
```

 
We would also compare the Fast seam distribution and check whether we can infer something from it. 

```{r echo = FALSE}
# Create greinke_july
greinke_july <- subset(data, july =="july")
# Create greinke_other
greinke_other <- subset(data, july == "other")
july_ff <- subset(greinke_july, pitch_type == "FF")
# Create other_ff
other_ff <- subset(greinke_other, pitch_type == "FF")
# Make a fastball speed histogram for other months
hist(other_ff$start_speed,
     col = "#00009950", freq = FALSE,
     ylim = c(0, .35), xlab = "Velocity (mph)",
     main = "Greinke 4-Seam Fastball Velocity , Blue = July and Orange = Other months")

# Add a histogram for July
hist(july_ff$start_speed,
      add = TRUE,
      col = "#99000050", freq = FALSE)

# Draw vertical line at the mean of other_ff
abline(v=mean(other_ff$start_speed), col = "#00009950", lwd = 2)

# Draw vertical line at the mean of july_ff
abline(v=mean(july_ff$start_speed), col = "#99000050", lwd = 2)
```

As we can see from the combined graph , The other months had a much higher speed as compared to July. This is important as Zack Greinke started pitching the ball in much faster velocity in July as compared to months. With average velocity also increasing as a result. It can very well be said that Greinke had a specific velocity which made him much more successful in July 2015. Faster balls meant that the batter had a tough outing facing Zack! 

Another interesting factor could be to compare the amount of strikes on the ball in the game that Zack has successfully achieved. We can look briefly at the amount of strikes in the graph below. 

```{r echo = FALSE}
ggplot(data , aes(strikes))+geom_histogram(bins = 3)+ggtitle("Strike status at the pitch")
```



As we can see , Zack had bowled more number when the strike status was 0. We may also want to see the amount of deliveries where the batter has been out. 

```{r echo = FALSE}
ggplot(data,aes(outs))+geom_histogram(bins = 3)
```


Zack is a very dangerous pitcher as seen from the above graph , Picking out batters in several occassion. 

```{r echo = FALSE}
ggplot(data,aes(inning)) + geom_histogram()+ggtitle("Innings count")
```

Zack has bowled mostly during the mid and opening innings of the game.

We now proceed with our findings from the analysis seen above. 

**Velocity** Played a vital part in making Zack a successful pitcher during the month of July. We do realize that overall Zack has been an excellent bowler but his average speed in July has been surprisingly higher than the speed noted during the other months. 

```{r echo = FALSE}
tapply(data$start_speed, data$july, mean)
```

As seen above , Zack has had a marginally higher start speed in the month of July. How about the fast seams ? 
```{r echo = FALSE}
greinke_ff <- subset(data, pitch_type == "FF")
# Calculate mean fastball velocities: ff_velo_month
ff_velo_month <- tapply(greinke_ff$start_speed, greinke_ff$july, mean)

# Print ff_velo_month
ff_velo_month
```

Meanwhile , The fast seams seem to have done the trick with Zack bowling an average speed higher than the noted velocity in other months. 

It now becomes clear that the speed at which the ball was thrown had some effect on the performance aspect. We may now further investigate about the same in the Bivariate analysis and how fast seam has worked out fine for Zack greinke. 

## Bivariate Analysis 

We shall start by assessing game by game average speed changes and try to analyse if it has been different for July ? 
To start off , We would be using the tapply function of R again. We would use it create another dataframe which would strictly be used for our Bivariate analysis. 

```{r echo = FALSE}
ff_dt <- data.frame(tapply(greinke_ff$start_speed, greinke_ff$game_date, mean))
ff_dt$game_date <- as.Date(row.names(ff_dt), "%Y-%m-%d")
# Rename the first column
colnames(ff_dt)[1] <- "start_speed"
# Remove row names
row.names(ff_dt) <- NULL
``` 

The step graph below , Shows the change of Start Speed by Zack , It is interesting to see how different has he pitched on the particular month. I have also included the line chart for further clarity. 

```{r echo =FALSE}
p1 = ggplot(ff_dt,aes(game_date,start_speed))+geom_step()+ggtitle("Month wise average start speed comparision (step)")
p2 = ggplot(ff_dt,aes(game_date,start_speed))+geom_line()+ggtitle("Month wise average start speed comparision")+geom_point()
grid.arrange(p1,p2,ncol = 2)

```

The step graph here indicates the change and plots it over the graph. As we can see that in the month of July , Zack has tried to bring a much slower and limited speed as compared to previous month where he has pitched slowly and as opposed to the latter part of the season where Zack has pitched at a considerable higher speed. We also note that his pitching speed increased in July. 

It also would be worth investigating specific performance for the month of July. 

```{r echo = FALSE}
ff_dt = separate(ff_dt, col = game_date,into = c("year", "month", "day"),sep = "-", remove = FALSE )
ff_dt$month = as.numeric(ff_dt$month)
```
```{r echo = FALSE}
ggplot(subset(ff_dt,month == 7),aes(game_date,start_speed))+geom_line()+ggtitle("July average start speed comparision")+geom_point()
```

As we could see his Speed variation has been excellent. Starting off at a speed of around 92.4 and going well upto 93.3 and finishing the month with the speed at which he started. 

Another thing to assess would be the delivery counts with respect to the innings , Is he fast during the opening innings or during the end. 

```{r echo = FALSE}
ggplot(data , aes(start_speed,inning))+geom_point(alpha = 0.2)+ggtitle("Innings wise Speed")
``` 

So there isn't much to infer but we can confirm that Zack has been bowling at a similar rate , Which means there isn't much variation of speed as far as innings of play is concerned. 

We may find the same for July below. 

```{r echo = FALSE}
ggplot(greinke_july, aes(start_speed,inning))+geom_point(alpha = 0.2)+ggtitle("Innings wise Speed for the month of July")
``` 

Yet again , Nothing different as far as the Speed of which the balls has been pitched is concerned. 

```{r echo =FALSE}
greinke <- subset(data, pitch_type != "IN" & pitch_type != "EP")
# Drop the levels from pitch_type
greinke$pitch_type <- droplevels(greinke$pitch_type)
# Create type_tab
type_tab <- table(greinke$pitch_type, greinke$july)
# Print type_tab
type_prop <- round(prop.table(type_tab, margin = 2), 3)
type_prop <- as.data.frame.matrix(type_prop)
Pitch <- rownames(type_prop)
type_prop <- cbind(Pitch, type_prop)
colnames(type_prop) <- paste(c("Pitch", "July", "Other"))
type_prop$Difference <- (type_prop$July - type_prop$Other)/type_prop$Other
```

To assess the change in pitch type rates for July and the other months , We create another dataframe which consists of types of pitches.We create a new dataframe which consists of the number of pitches thrown in July as compared to the other month for each and every type of pitch. 
We then use , prop table which takes two argument, In our case the number of pitches per type and converts them into ratio. These ratio's can then be used to see the changes in pitching. 

```{r echo =FALSE}
barplot(type_prop$Difference, names.arg = type_prop$Pitch, 
        main = "Pitch Usage in July vs. Other Months", 
        ylab = "Percentage Change in July", 
        ylim = c(-0.4, 0.4))
``` 

This gives us a very interesting look at how Zack had a negative change in the Fast seam balls that he threw during the course of July as compared to the rest of the season. This could be a concrete proof that Zack did increase the use of three different types of pitching in July. These changes are very important for our Conclusion. 

Let us also evaluate the pitch locations where Zack has been bowling. This could give us an idea where the ball has been thrown and how has it been different in comparision to other months from July. 

The overall pitching by Zack has been excellent and can be seen below. 


```{r echo = FALSE}
ggplot(data, aes(px,pz))+geom_point(alpha = 0.2)+ggtitle("Overall pitching by Zack")
```

So apart from that one bad ball thrown somewhere around the stands, Zack has been aiming right below and on the bat to get his man. But how is july different


```{r echo =FALSE}
p1 = ggplot(greinke_july,aes(px,pz))+geom_point(colour = 'red',alpha = 0.2)+ggtitle("July Pitching")
p2 = ggplot(greinke_other,aes(px,pz))+geom_point(color = 'blue',alpha = 0.2)+ggtitle("The rest of the season pitching")
grid.arrange(p1,p2,ncol = 2)
```


So the horror pitching was in July , Well glad that's sorted. But apart from that we can see that the pitching has been well pertained to the left of the right handed batsman which is excellent place to pitch. Maybe this made him famous in July ? 

Let's do further analysis so as to Spin can be a criteria for Zack's success. We do realize that till now , We've established that Speed has been different but is there any correlation between the speed and spin of the ball ? 

We find that by plotting a graph to see affect of speed and spin . 

```{r echo =FALSE}
ggplot(data , aes(start_speed,spin_rate))+geom_point(alpha = 0.2)+ggtitle("Spin vs Speed comparsion")
```

We can establish that the spin rate by Zack is not upto the mark. He has been struggling to get hold of the spin well that is natural as the ball travels at a faster speed. 

So , We did establish the fact that Zack has been a very good pitcher. Let's look at his performance in July as compared to other months for the very same.

```{r echo =FALSE}
p1 = ggplot(greinke_july , aes(start_speed,spin_rate))+geom_point(alpha = 0.2)+ggtitle("July Spin vs Speed comparsion")
p2 = ggplot(greinke_other , aes(start_speed,spin_rate))+geom_point(alpha = 0.2)+ggtitle("Other months Spin vs Speed comparsion")
grid.arrange(p1,p2,ncol=2)
```

More spin in July ? That doesn't seems to be the case. Let us look at the average of spin in the month of July :- 

```{r echo=FALSE}
mean(greinke_july$spin_rate)
```

and , Rest of the months :- 

```{r echo =FALSE}
mean(greinke_other$spin_rate)
``` 

Spin rate doesn't seem to be the case as Zack has been consistent with spin throughout the season of 2015. 

Which bring us to the end of this Bivariate analysis , The key takeaway from which could be the difference in pitch usage and also , the position at which the ball has been thrown. 

## MULTIVARIATE ANALYSIS 

As seen previously in the Bivariate analysis , July had a different area of pitching. A different type of pitching. We now further see how the areas are actually different for different types of pitching. 
We first see the overall pitching coordinates per type of pitching below , 

```{r echo = FALSE}
ggplot(data , aes(px,pz,col=factor(pitch_type)))+
  geom_point(alpha=0.1)+
  facet_grid(.~pitch_type)+ggtitle("Where did Zack pitch for individual type of pitch")
```

As we can see that in FF the height at which the ball reaches the batter is high as compared to SL balls where the height is low basically a knucleball to get the batter out. 

We further investigate how different has it been for July. 

```{r echo = FALSE}
ggplot(greinke_july , aes(px,pz,col=factor(pitch_type)))+
  geom_point(alpha=0.4)+
  facet_grid(.~pitch_type)
```

As seen above we can infer that Zack has pitched the ball a bit lower , Especially the SL balls. Maybe it was important for his incredible performance.But , As we can see that Greinke had been a consisten player in MLB before , We now would see the ball-strike graph for each and every month to further enhance our investigation. 

```{r echo = FALSE}
ggplot(data , aes(outs,start_speed,col=factor(month)))+
  geom_point(alpha=0.4)+
  facet_grid(.~month)
```

We can see that there is nothing which can conclusively say that Zack has had a different speed or performance , His performance has been very consistent and has got a good average to show for. 
Let's take a look at the statistics on how Zack has had his out rates as well as ratio of pitching and outs. 

```{r echo =FALSE}
print("July out value counts")
summary(factor(greinke_july$outs))
print("Other out value counts")
summary(factor(greinke_other$outs))
print("Mean of outs in July")
mean(greinke_july$outs)
print("Mean of outs in others")
mean(greinke_other$outs)
```

Let's evaluate his pitching patterns for out and try to find whether it has been any different in July ? 

```{r echo = FALSE}
ggplot(data , aes(px,pz,col=factor(outs)))+
  geom_point(alpha=0.4)+
  facet_grid(.~outs)+ggtitle("Outs position entire season")
```

The more left side of the right side batter he pitches he get's them back to pavillion. This can be said , Not strongly though. 

We can further see if the pitching has been different in July ? 

```{r echo = FALSE}
ggplot(greinke_july , aes(px,pz,col=factor(outs)))+
  geom_point(alpha=0.4)+
  facet_grid(.~outs)+ggtitle("Outs for July , Pitch Position")
```

Similar to our previous graphs , the more right hand side he throws he has had much better luck. But yet again this doesn't change the fact that it hasn't been any different in July. 

Let's evaluate for the Speed , Spin rate and the outs then we can further see if that had been any different in the month of July. 

```{r echo = FALSE}
ggplot(data , aes(spin_rate,start_speed,col=factor(outs)))+
  geom_point(alpha=0.4)+
  facet_grid(.~outs)+ggtitle("Speed , Spin is he out ? ")
```

Yet again , Similar pitches , Similar Spin rate , Similar Speed and different results , Maybe he had a great luck. 

Let's further see for July to figure out if the dismissal was different. 

```{r echo = FALSE}
ggplot(greinke_july , aes(spin_rate,start_speed,col=factor(outs)))+
  geom_point(alpha=0.4)+
  facet_grid(.~outs)+ggtitle("Speed , Spin is he out (July) ? ")
```

Yet again nothing can be established since the delivery seems to be the same. Just that slower delivery seem to have got batters out. 


## FINDINGS 

There seems to be nothing different with the way Zack Greinke has performed in July 2015. The fact that many thought about his incredible form is actually his standard which has been followed. A certain something which similarly in happens in Football , where the player of a higher standard is overhyped (Lingard , Sanchez for example) who after scoring two goals become a beast. So how did we reach that conclusion ? 

**The Speed** 

In a game which involves pitchers whether it's Cricket or Baseball , Speed has always been a vital part for the evaluation of the bowler in this case a pitcher. Let's take Bret Lee for an example , When he used to bowl at 150kmph he used to break those wickets. We tried to see if that has been the case here ie , whether Zack pitched the ball at faster rate than usual ? Apparently there was a slight a bit of change in the speed as compared to his previous month which can be relooked below , 

```{r echo =FALSE}
p1 = ggplot(ff_dt,aes(game_date,start_speed))+geom_step()+ggtitle("Month wise average start speed comparision (step)")
p2 = ggplot(ff_dt,aes(game_date,start_speed))+geom_line()+ggtitle("Month wise average start speed comparision")+geom_point()
grid.arrange(p1,p2,ncol = 2)

``` 

We did arrive to a conclusion that , He did up his speed in June and dropped in July and further increased in August. We can also see the increase in speed for the month of July. Where he did drop his speed and then later on bowled ultra fast! 

```{r echo = FALSE}
ggplot(subset(ff_dt,month == 7),aes(game_date,start_speed))+geom_line()+ggtitle("July average start speed comparision")+geom_point()
```

Hence we did try to check how has the speed been different/fast ? 
```{r echo = FALSE}
# Print ff_velo_month
ff_velo_month
```

**Postion of the pitch** 

This is something which we deeply looked upon , Something which actually gave us hope that we would be able to prove the media reports right. We kinda did prove by the fact that Zack pitched more towards the left of a right handed batter. But the same traits has been for the rest of the months too! We cannot establish that has a fact , but we can surely say that it is vital. 
Yet again in sports such as cricket/baseball the pitching is a very vital factor. Daniel Vittori the spin bowler (Cricket) from new zealand can give few tips about it. We tried to see if Zack had an inner Vittori he didn't and the graphs says that he did try. 

```{r echo =FALSE}
p1 = ggplot(greinke_july,aes(px,pz))+geom_point(colour = 'red',alpha = 0.2)+ggtitle("July Pitching")
p2 = ggplot(greinke_other,aes(px,pz))+geom_point(color = 'blue',alpha = 0.2)+ggtitle("The rest of the season pitching")
grid.arrange(p1,p2,ncol = 2)
``` 

As we could see from the graph , Pitching has been towards a lower right which does sound good but it hasn't been a very magnificent finding afterall. 

**Pitch types** 

As said previously , Pitching was something which was inspirational and we did try to establish one thing that Zack did change his type of pitchings in July. Results ? not very different he has enjoyed success throwing all types of ball. This man is a legend. 

```{r echo =FALSE}
barplot(type_prop$Difference, names.arg = type_prop$Pitch, 
        main = "Pitch Usage in July vs. Other Months", 
        ylab = "Percentage Change in July", 
        ylim = c(-0.4, 0.4))
``` 

We then saw if there has been different pitch position for these pitch types , We did get some feedback and can be seen below  

```{r echo = FALSE}
ggplot(data , aes(px,pz,col=factor(pitch_type)))+
  geom_point(alpha=0.1)+
  facet_grid(.~pitch_type)+ggtitle("Where did Zack pitch for individual type of pitch")
```

Is it different then July ? 

```{r echo = FALSE}
ggplot(greinke_july , aes(px,pz,col=factor(pitch_type)))+
  geom_point(alpha=0.1)+
  facet_grid(.~pitch_type)+ggtitle("Where did Zack pitch for individual type of pitch")
```

Sadly no! His types of pitching for the delivery is same. 

We also checked the positions at which balls was pitched and batter was out , It was again the same towards the left side of the right handed batter. Which can be seen below , 

```{r echo = FALSE}
ggplot(data , aes(px,pz,col=factor(outs)))+
  geom_point(alpha=0.4)+
  facet_grid(.~outs)+ggtitle("Outs position entire season")
```

been different in July ? No. Similar type of deliveries were bowled. 

```{r echo = FALSE}
ggplot(greinke_july , aes(px,pz,col=factor(outs)))+
  geom_point(alpha=0.4)+
  facet_grid(.~outs)+ggtitle("Outs for July , Pitch Position")
```


## CONCLUSION 

We tried to see if the media hype in July 2015 for Zack Greinke justified that is , Did he do anything differently ? He didn't. Zack has been pretty consistent and his pitching patterns remain the same throughout the season with the only improvement coming from the fact that he increased his speed at lateral part of the season. 
We also tried to find if fatigue could be an issue and he could drop his speed , that wasn't the case. Zack Greinke might have just been exceptional in mental aspects and overall aspects but as far as pitching is concerned there was nothing different. We can further analyse by using the batters data to find out how many runs were scored and the outcome of each and individual ball thrown at the batter by Zack which might give us a better conclusion to reach. But we can conclude Zack Greinke of Kansas City is an incredible pitcher but with a pattern this pattern might help a batter cope up the pressure given by Zack. 



